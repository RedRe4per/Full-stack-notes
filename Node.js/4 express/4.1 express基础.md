### Node.js 4.1 Express 基础

1. **Express 简介**

   [Express](https://www.expressjs.com.cn/) 是基于 Node.js 平台，快速、开放、极简的 Web 开发框架。Express 的作用和 Node.js 内置的 http 模块类似，是专门用来创建 Web 服务器的。

   Express 的本质：就是一个 npm 上的第三方包，提供了快速创建 Web 服务器的便捷方法。

   如果不使用 Express，就需要用原生 http 模块即可。但 http 内置模块用起来很复杂，开发效率低；Express 是基于内置的 http 模块进一步封装出来的，能够极大的提高开发效率（类似 Web API 和 jQuery 的关系）。

   

2. **Express 能做什么**

   对于前端程序员来说，常见的两种服务器是：

   1. <font color='green'>Web 网站服务器</font>：专门对外提供 Web 网页资源的服务器。
   2. <font color='green'>API 接口服务器</font>：专门对外提供 API 接口的服务器。

   Express 可以快速方便的创建这两种服务器。

   

3. **安装 Express**

   终端命令：`npm i express@4.17.1` （课程中版本）

   

4. **创建 Web 服务器**

   ```javascript
   const express  = require('express')
   const app = express()
   
   app.listen(80, () => {
       console.log('express server running at http://127.0.0.1')
   })
   ```

   

5. **监听 GET/POST 请求**

   通过 `app.get()` `app.post()`方法，可以监听客户端的 GET 请求。

   ```javascript
   app.get('请求URL', function(req, res){})
   app.post('请求URL', function(req, res){})
   ```

   

6. **把内容响应给客户端**

   `res.send()` 方法，可以把处理好的内容发送给客户端。（`res.send()` 默认状态码为200）

   ```javascript
   app.get('/user', (req, res) => {
       res.send({name:'zs', age:20, gender:'male'})
   })
   app.post('/user', (req, res) => {
       res.send('request succeed')
   })
   ```

   

   <font color='red'>`res.json()` 方法</font>与 `res.send()` 方法运行结果是一样的。

   区别是`res.send()` 有一个检查，检查传入对象是字符串还是 json 格式还是其他。如果是 json 对象，就以 json 格式返回。这相当于 `res.send()` 内置了 `res.json()` 方法。写 `res.json()` 方法相当于更明确一些，确定把对象以 json 格式传输回去。写的时候一般选择 `res.json()` 方法。

   

   如果想只返回响应状态码，可以用 `res.sendStatus()`，如：

   ```javascript
   res.sendStatus(204)
   ```

   只设置状态码而不返回：

   ```javascript
   res.status(201)    //会返回一个response对象
   ```

   ```javascript
   res.status(201).json({})    //同时返回相应数据
   ```

   

7. **return 的问题**

   `app.get('/', (req, res) => { return })` 中 return 是个人代码风格问题，大部分情况下加不加 return 都一样。<font color='red'>但是有一种情况必须加 return，即回调函数中涉及 if 等逻辑判断产生分支。</font>在分支中，每个分支必须加 return 以确保后面的其他分支代码不会被执行。

   

   另外，以下两种 return 写法也是有区别的：

   ```javascript
   res.send('Hello world');
   return;
   ```

   ```javascript
   return res.send('Hello world');
   ```

   从代码运行的结果来说，这两种写法无区别。但如果涉及 TS 类型检查，会导致返回不同类型：第一种写法返回 undefined，第二种返回 respond 类型。

   

8. **从 req 中取数据的方式 **

   1. body 取数据

      `req.body` 可以取客户端发来的请求体中的数据。用于 POST，PUT，PATCH 请求。

      ```javascript
      const {name} = req.body;
      res.send({name})   //此处为ES6缩写，应为res.send({name: name})
      ```

      

   2. query param 取数据

      `req.query` 可取到客户端通过<font color='red'>查询字符串</font>形式，从 URL 中发送到服务器的参数。默认为空对象，用于 GET 请求。

      ```javascript
      app.get('/', (req, res) => {   //客户端使用 ?name=tom&age=20 这种查询字符串形式发送的参数
          console.log(req.query.name)  //可以用req.query中的属性访问到
          console.log(req.query.age)
          res.send(req.query)
      })
      ```

      

   3. route param （`/:id` ）取数据（获取 URL 中的动态参数）

      `req.params` 对象可以访问到 URL 中，通过<font color='red'> `:` </font>匹配到的<font color='red'>动态参数</font>。`:` 后面的字符串是可以任意写的，只要合理合法即可，而 `req.params` 对象最终返回的结果即为 `{":后字符串":"客户端请求的动态参数"}` 。 例如 `/my/article/:id` ，其中 id 不是静态值，而是一个动态参数（动态匹配到的参数值）。`req.params` 默认为空对象。

      route param 可用于 GET，POST，PUT，DELETE 四种操作，但大多数情况下都是 id。

      ```javascript
      app.get('/user/:id', (req, res) => {  //客户端请求为http://127.0.0.1/1，id即为1。 
          console.log(req.params)
          res.send(req.params)       //返回的结果是{"id":"1"}
      })         
      ```

      

      动态参数也可以有多个，如 

      ```javascript
      app.get('/user/:id/:name', (req, res) => {}
      ```

      服务器端请求应为 http://127.0.0.1/1/Tom 。





