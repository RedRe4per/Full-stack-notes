**检索部分**

技术点

1. 9个 filter，同时工作， 可以同时选择多个筛选条件。

   

**客户预约部分**

技术点

1. 服务可用时间可视化：统计图表，展示一天中的 [营业时间 / 非营业时间]。在营业时间中，可以展示每个时间节点（精确到5分钟）的预约数量。如果预约已满，会用红色呈现。
2. 灵活的预约时间选取。服务的预约模式分为 fixed duration，changeable duration，unlimited duration。
   1. 在 unlimited duration 中，只要某个时间点没满，就可以预约。
   2. 在 fixed duration 中，如果 【某个时间点】和 【这个时间点 + duration】的所有时间
3. 





ppt里说一下技术难点

大家好，我是Derek。我们的项目中有很多的挑战，并且战胜了它们。现在由我来介绍一下项目中最困难的挑战，即我们的亮点。

1. searching（应删除）

   为了在多个页面中按特定条件检索store，我们设计了包括类别、日期、用户输入文字、地区在内的等9个filter。这是用 mongoose 的 aggregation 技术实现的。

   

2. 用户预约查重/ 决策树

   在预约平台中，客户的预约判定是一个核心功能。我们采用预先筛选 + 下订单时确认的方式来检测用户的订单。

   在预选筛选中，当用户进入某个店铺，并且选定了日期后，只有可预定的服务才会呈现在页面中，供用户进一步选择；当用户选择服务后，服务的营业时间和各个时间的预约数量会以可视化图表的形式呈现，并且用来选取预定时间和duration的 roller 中只会呈现可用的时间。

   在订单提交后，我们使用决策树来决定用户是否可以成功预约，它会返回一个成功或失败的结果。如果用户的预约是成功的，我们把预约信息放入数据库的 order 表中，并把用户所选时间区间的所有timeSlice 放入商家 booking Record 中，以计算预约数量和是否已满。如果用户预约是失败的，系统会返回失败原因，如用户重复预约/所选时间不是营业时间/所选时间已满。

   这种预先筛选 + 下订单时确认的方式既保证了订单判定的严谨，又保证了用户下单时的体验（即用户能选到的时间极大概率预约成功）。

   

3. store： 3个表联动。同步更新

   在我们的设计中，每个 store 下商家可以添加多个 service Info；用户预约服务时，如果这个用户是 **这个服务** 在 **某一周** 的第一个订单，则会生成一个新的 booking Record，否则的话就会在已有的 booking Record 中添加数据。

   在 store 中，商家需要设置营业时间。而在 service 中，商家可以重新设置 service 单独的营业时间，也可以直接将 store 的营业时间同步至 service 中，之后再修改。我们还有一个互锁机制对商家的修改作出限制，即：服务的营业时间必须在店铺营业时间内，而如果商家想删除某段店铺营业时间，这段营业时间必须没有任何服务。

   而在商家修改 service 的 calendar 时，我们会在数据库中同步连锁更新这个 service 对应的所有已创建的 booking Record。但是，删除 service 的某段营业时间，并不会影响客户已预约的订单。

   

之后的 demo 中，我们也会为大家展现这些亮点。现在请我们的组员开始演示。

前端



**RTK**

**（待定）calendar design**

no third party library

